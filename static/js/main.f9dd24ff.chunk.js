(this.webpackJsonpgame1=this.webpackJsonpgame1||[]).push([[0],{114:function(e,t,a){e.exports=a(160)},119:function(e,t,a){},120:function(e,t,a){},144:function(e,t,a){e.exports=a.p+"static/media/UMPO.53770ec2.png"},160:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(28),r=a.n(i),s=(a(119),a(40)),c=a(41),l=a(17),u=a(52),p=a(51),d=(a(120),a(8)),h=(a(131),a(35)),m=a.n(h),f=m.a.initializeApp({apiKey:"AIzaSyCU3lAPlsxkBORPy2HQfCdayJNIIh0PrV4",authDomain:"game1-cae49.firebaseapp.com",databaseURL:"https://game1-cae49.firebaseio.com",projectId:"game1-cae49",storageBucket:"game1-cae49.appspot.com",messagingSenderId:"691468574984",appId:"1:691468574984:web:1c76454a2ec3020e820cbd",measurementId:"G-1B23MNQTH4"});m.a.analytics();var v=f,b=a(36),g=a.n(b),k=a(50),y=function(){var e=Object(k.a)(g.a.mark((function e(t){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={id:t,warPoints:0,lastTaken:+new Date,points:[]},v.firestore().collection("users").doc(t.toString()).get().then((function(e){e.exists||v.firestore().collection("users").doc(t.toString()).set(a).then((function(e){console.log("\u0421\u041e\u0417\u0414\u0410\u041d \u041f\u041e\u041b\u042c\u0417\u041e\u0412\u0410\u0422\u0415\u041b\u042c"),window.location.reload()}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=a(16),C=a.n(w),E=a(23),S=a.n(E),P=function(e){var t=null,a=[];return location.search.substr(1).split("&").forEach((function(n){(a=n.split("="))[0]===e&&(t=decodeURIComponent(a[1]))})),t},_=a(29),I=a(27),O=a.n(I),T=(a(39),a(34)),D=a.n(T),z=a(37),j=a.n(z),x=a(38),U=a.n(x),A=function(){return parseInt(+new Date/1e3)},B=function(e,t){return(parseInt(A()/60)-parseInt(t/60))*e},R=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return 6*e*60},V=function(e){var t=e.data.name,a=e.data.description,n=e.owner,i=parseInt(P("vk_user_id"))===n.id,r=B(e.data.value,e.data.taken);return o.a.createElement("div",{id:"layout"},o.a.createElement("div",{id:"layoutBG",style:{backgroundImage:"url("+e.data.background+")",width:"100%",height:"30vh",backgroundAttachment:"scroll",backgroundClip:"border-box",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}}),o.a.createElement(d.d,{className:"layoutName"},t),o.a.createElement(d.j,{before:o.a.createElement(D.a,null)},a),o.a.createElement(d.j,{before:o.a.createElement(d.b,{size:48,src:n.photo_200}),description:"\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446"},n.first_name+" "+n.last_name),o.a.createElement(d.j,{style:i?{display:"none"}:{},onClick:e.buy,multiline:!0,before:o.a.createElement("img",{src:O.a,alt:"\u043f\u0435\u0432\u043a\u043e",width:24,height:24}),expandable:!0},"\u041f\u0435\u0440\u0435\u043c\u0430\u043d\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u044f\u0433 \u0437\u0430 ",B(e.data.value,e.data.taken)," \u043f\u0435\u0432\u043a\u0430"),o.a.createElement(d.j,{style:i?{}:{display:"none"},onClick:e.collect,multiline:!0,before:o.a.createElement("img",{src:O.a,alt:"\u043f\u0435\u0432\u043a\u043e",width:24,height:24}),expandable:!0,description:o.a.createElement(d.h,{value:r/R(e.data.value)*100>100?100:r/R(e.data.value)*100})},"\u0421\u043e\u0431\u0440\u0430\u0442\u044c ",r>R(e.data.value)?R(e.data.value):r," \u043f\u0435\u0432\u043a\u0430"),o.a.createElement("div",{onClick:function(){S()("#layout").removeClass("active")},style:{position:"absolute",bottom:15,left:"calc(50% - 36px)",boxShadow:"2px 2px 10px -1px rgba(0,0,0,0.55)",padding:10,borderRadius:25}},"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"))},M=(a(144),function(e){if(!e.areas.length||!e.users.U1)return"...";for(var t=[[[54.779493,56.124385],[54.779497,56.131224],[54.776341,56.131215],[54.776348,56.124403]],[[54.781021,56.124396],[54.781036,56.131236],[54.779497,56.131224],[54.779493,56.124385]],[[54.785005,56.124335],[54.785039,56.124738],[54.785051,56.125118],[54.785528,56.125112],[54.785721,56.125202],[54.785853,56.125454],[54.786095,56.126215],[54.786116,56.131269],[54.781036,56.131236],[54.781021,56.124396],[54.783463,56.12439]],[[54.788083,56.121598],[54.788085,56.131268],[54.786116,56.131269],[54.786095,56.126215],[54.785853,56.125454],[54.785721,56.125202],[54.785528,56.125112],[54.785051,56.125118],[54.785039,56.124738],[54.785005,56.124335],[54.785419,56.124109],[54.785716,56.123839],[54.786556,56.122793],[54.787478,56.121806]],[[54.788085,56.131268],[54.78809,56.138701],[54.787969,56.138726],[54.787872,56.138638],[54.787739,56.138423],[54.787534,56.138267],[54.787422,56.138271],[54.78731,56.138139],[54.787207,56.138088],[54.786705,56.138104],[54.786612,56.138182],[54.786502,56.138185],[54.786435,56.138273],[54.78132,56.138272],[54.781204,56.138015],[54.781135,56.137899],[54.781022,56.137387],[54.781036,56.131236]],[[54.776348,56.124403],[54.776341,56.131215],[54.775451,56.131214],[54.775371,56.131147],[54.775293,56.130954],[54.774989,56.130881],[54.774843,56.130696],[54.774628,56.130616],[54.773699,56.130516],[54.773455,56.131214],[54.773055,56.131289],[54.772976,56.13086],[54.772956,56.129272],[54.773206,56.127888],[54.773471,56.127201],[54.77381,56.126584],[54.774408,56.125915],[54.774385,56.12584],[54.774392,56.124427]],[[54.78011,56.116825],[54.780185,56.117445],[54.780169,56.124392],[54.774392,56.124427],[54.774246,56.12135],[54.773549,56.117302],[54.773503,56.116494],[54.773547,56.115505],[54.773647,56.114637],[54.773814,56.113825],[54.774018,56.113179],[54.774138,56.112975],[54.774406,56.112635],[54.7758,56.11359]],[[54.783401,56.121429],[54.783411,56.122845],[54.783463,56.12439],[54.780169,56.124392],[54.780179,56.121533],[54.780351,56.121501],[54.781185,56.12141],[54.78157,56.121394]],[[54.783423,56.11553],[54.783421,56.116032],[54.783406,56.116767],[54.783399,56.117089],[54.783412,56.118041],[54.78341,56.119827],[54.783401,56.121429],[54.78157,56.121394],[54.781185,56.12141],[54.780351,56.121501],[54.780179,56.121533],[54.780185,56.117445],[54.78011,56.116825],[54.780063,56.116583],[54.78005,56.115524]],[[54.780024,56.112637],[54.780035,56.113903],[54.78005,56.115524],[54.780063,56.116583],[54.78011,56.116825],[54.7758,56.11359],[54.774406,56.112635],[54.77439,56.111932],[54.774399,56.11172],[54.77444,56.111479],[54.774584,56.11101],[54.775041,56.109647],[54.774897,56.109436],[54.774889,56.109296],[54.774936,56.109133],[54.775397,56.108206],[54.775899,56.107353],[54.776538,56.106487],[54.777265,56.106672],[54.777663,56.106938],[54.777868,56.106967],[54.778242,56.106967],[54.778576,56.107238],[54.778652,56.107482],[54.778627,56.107721],[54.778875,56.108131],[54.778954,56.108587],[54.779057,56.109094],[54.779165,56.109505],[54.779291,56.110143],[54.77941,56.110763],[54.779543,56.111265],[54.779607,56.111497],[54.77977,56.11162],[54.779881,56.111878],[54.779988,56.11217]],[[54.785809,56.115501],[54.785955,56.118246],[54.786925,56.119222],[54.787296,56.119897],[54.787597,56.120338],[54.78766,56.120319],[54.78773,56.119954],[54.788112,56.120155],[54.788083,56.121598],[54.787478,56.121806],[54.786556,56.122793],[54.785716,56.123839],[54.785419,56.124109],[54.785005,56.124335],[54.783463,56.12439],[54.783411,56.122845],[54.783401,56.121429],[54.78341,56.119827],[54.783412,56.118041],[54.783399,56.117089],[54.783421,56.116032],[54.783423,56.11553],[54.784622,56.115512]]],a=[],n=0;n<t.length;n++){a[n]=[];for(var i=0;i<t[n].length;i++)a[n][i]={lat:0,lng:0},a[n][i].lat=t[n][i][0],a[n][i].lng=t[n][i][1]}return o.a.createElement(_.Map,{onReady:function(t,a){return e.removeIcons(t,a)},style:{width:"100%",height:"calc(100vh - 57px)"},google:e.google,zoom:e.zoom,className:"map",streetViewControl:!1,mapTypeControl:!1,scaleControl:!1,fullscreenControl:!1,zoomControl:!1,onBoundsChanged:e.onDragged,initialCenter:e.center},a.map((function(t,a){return o.a.createElement(_.Polygon,{onClick:function(){e.polyClick(a)},paths:t,key:"poly"+t[0].lat+" "+t[1].lng+e.users["U"+e.areas[a].owner].color,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:e.users["U"+e.areas[a].owner].color,fillOpacity:.35})})))}),W=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={activeView:"main",activePanel:"main",VK_UID:0,userData:{id:0,warPoints:0,points:[]},popout:"",modal:"",snackbar:"",activeTab:0,center:{lat:54.77927,lng:56.123964},zoom:14,workingProgress:0,activeTabOwner:{first_name:"\u041c\u0443\u0436\u0438\u043a",last_name:"\u0422\u0430\u0434\u0436\u0438\u043a",photo_200:"https://sun9-60.userapi.com/c849532/v849532674/13d845/_Rsu5onfz-c.jpg",points:[]},points:[{name:"\u041f\u044f\u0442\u0430\u0447\u043e\u043a",value:5,lat:54.791769,lon:56.086817,owner:0,background:"https://firebasestorage.googleapis.com/v0/b/game1-cae49.appspot.com/o/inorsBG%2F%D0%BF%D1%8F%D1%82%D0%B0%D0%BA.png?alt=media&token=e27c9707-bdb0-4dcf-96ec-586d00fea6eb",description:"\u0430\u0443\u0435",taken:0}],areas:[],users:[]},n.openPanel=n.openPanel.bind(Object(l.a)(n)),n.markerClick=n.markerClick.bind(Object(l.a)(n)),n.openCaptureModal=n.openCaptureModal.bind(Object(l.a)(n)),n.kupitRabotyag=n.kupitRabotyag.bind(Object(l.a)(n)),n.collectPevko=n.collectPevko.bind(Object(l.a)(n)),n.pointOwnerUpdate=n.pointOwnerUpdate.bind(Object(l.a)(n)),n.polyClick=n.polyClick.bind(Object(l.a)(n)),n.onDragged=n.onDragged.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.setState({VK_UID:P("vk_user_id")}),C.a.send("VKWebAppInit",{}).then((function(){return console.log("\u0412\u041a \u041f\u041e\u0414\u041a\u041b\u042e\u0427\u0415\u041d")})),y(P("vk_user_id")).then((function(){v.firestore().collection("users").doc(P("vk_user_id").toString()).onSnapshot((function(t){e.setState({userData:t.data()})})),v.firestore().collection("data").doc("areas").onSnapshot((function(t){t.data()&&e.setState({areas:t.data().main})})),v.firestore().collection("data").doc("users").onSnapshot((function(t){t.data()&&e.setState({users:t.data().main})}))}))}},{key:"componentWillUnmount",value:function(){}},{key:"kupitRabotyag",value:function(){var e=this,t=o.a.createElement(d.k,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--accent)"}},o.a.createElement(j.a,{fill:"#fff",width:14,height:14}))},"\u0420\u0430\u0431\u043e\u0442\u044f\u0433\u0438 \u0442\u0435\u043f\u0435\u0440\u044c \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u043f\u0435\u0432\u043a\u043e \u0432\u0430\u043c"),a=o.a.createElement(d.k,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--field_error_border)"}},o.a.createElement(U.a,{fill:"#fff",width:14,height:14}))},"\u041d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u0435\u0432\u043a\u0430 \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u043c\u0430\u043d\u0438\u0432\u0430\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044f\u0433");this.setState({popout:o.a.createElement(d.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u041f\u0435\u0440\u0435\u043a\u0443\u043f\u0438\u0442\u044c",autoclose:!0,action:function(){var n=e.state.userData.warPoints-B(e.state.points[e.state.activeTab].value,e.state.points[e.state.activeTab].taken),o=v.firestore().collection("users"),i=o.doc(e.state.points[e.state.activeTab].owner.toString());if(n>=0){e.setState({snackbar:t});var r,s=e.state.userData.points;i.get().then((function(t){r=t.data().points,s.push(e.state.activeTab),r.splice(r.indexOf(e.state.activeTab),1),i.update({points:r}).then((function(){return o.doc(P("vk_user_id").toString()).update({points:s,warPoints:n}).then((function(){var t=e.state.points;t[e.state.activeTab].owner=parseInt(P("vk_user_id")),t[e.state.activeTab].taken=A(),v.firestore().collection("data").doc("points").update({main:t}).then((function(){e.pointOwnerUpdate()}))}))}))}))}else e.setState({snackbar:a})}}],onClose:function(){e.setState({popout:null})}},o.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),o.a.createElement("p",null,"\u041f\u0435\u0440\u0435\u043a\u0443\u043f\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u044f\u0433 \u0437\u0430 ",B(this.state.points[this.state.activeTab].value,this.state.points[this.state.activeTab].taken)," \u043f\u0438\u0432\u0430."))})}},{key:"openPanel",value:function(e){this.setState({activePanel:e})}},{key:"openView",value:function(e){this.setState({activeView:e})}},{key:"pointOwnerUpdate",value:function(){var e=this;C.a.send("VKWebAppGetAuthToken",{app_id:7446907,scope:""}).then((function(t){return C.a.send("VKWebAppCallAPIMethod",{method:"users.get",request_id:"32test",params:{fields:"photo_200",user_ids:e.state.points[e.state.activeTab].owner.toString(),v:"5.110",access_token:t.access_token}}).then((function(t){e.setState({activeTabOwner:t.response[0]})}))}))}},{key:"markerClick",value:function(e,t,a){var n=this;if("\u0421\u043a\u043b\u0430\u0434 \u043f\u0435\u0432\u043a\u0430"===e.name)return this.openPanel("warehouse"),0;if("\u0423\u041c\u041f\u041e"===e.name){var i=setInterval((function(){var e=o.a.createElement(d.k,{layout:"vertical",onClose:function(){return n.setState({snackbar:null})},before:o.a.createElement("img",{alt:"pevko",src:O.a,width:24,height:24})},"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e 15 \u043f\u0435\u0432\u043a\u0430");n.setState({workingProgress:n.state.workingProgress+10,snackbar:e}),v.firestore().collection("users").doc(P("vk_user_id").toString()).update({warPoints:n.state.userData.warPoints+15})}),1e4);return S()(".map").hide(),S()("html").addClass("wLout"),this.setState({popout:o.a.createElement(d.a,{actionsLayout:"vertical",actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"}],onClose:function(){S()(".map").show(),S()("html").removeClass("wLout"),n.setState({popout:null,workingProgress:0}),clearInterval(i)}},o.a.createElement("h2",null,"\u0420\u0410\u0411\u043e\u0442\u0430\u0435\u043c"),o.a.createElement(d.l,{size:"large"}))}),0}S()("#layout").addClass("active"),this.setState({activeTab:e.num}),this.pointOwnerUpdate()}},{key:"removeIcons",value:function(e,t){t.setOptions({styles:[{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]}]})}},{key:"collectPevko",value:function(){var e=this,t=B(this.state.points[this.state.activeTab].value,this.state.points[this.state.activeTab].taken),a=R(this.state.points[this.state.activeTab].value);t>a&&(t=a);var n=o.a.createElement(d.k,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--accent)"}},o.a.createElement(j.a,{fill:"#fff",width:14,height:14}))},"\u041f\u0435\u0432\u043a\u043e (",t,") \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u043d\u0430 \u0441\u043a\u043b\u0430\u0434"),i=o.a.createElement(d.k,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--field_error_border)"}},o.a.createElement(U.a,{fill:"#fff",width:14,height:14}))},"\u0420\u0430\u0431\u043e\u0442\u044f\u0433\u0438 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043d\u0430\u043f\u0440\u044f\u0433\u0430\u0442\u044c\u0441\u044f \u0437\u0430 \u0441\u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0432\u043a\u0430");t>=15?v.firestore().collection("users").doc(P("vk_user_id").toString()).update({warPoints:this.state.userData.warPoints+t}).then((function(){var t=e.state.points;t[e.state.activeTab].taken=A(),v.firestore().collection("data").doc("points").update({main:t}).then((function(){return e.setState({snackbar:n})}))})):this.setState({snackbar:i})}},{key:"openCaptureModal",value:function(e){}},{key:"onDragged",value:function(e,t){this.setState({center:{lat:t.center.lat(),lng:t.center.lng()},zoom:t.zoom})}},{key:"polyClick",value:function(e){this.openPanel("warehouse")}},{key:"render",value:function(){var e=this;return o.a.createElement(d.i,{activeView:this.state.activeView},o.a.createElement(d.m,{popout:this.state.popout,id:"main",activePanel:this.state.activePanel},o.a.createElement(d.e,{id:"main"},o.a.createElement(d.f,null,"\u0411\u0418\u0422\u0412\u0410 \u0417\u0410 \u0418\u041d\u041e\u0420\u0421"),o.a.createElement(M,{areas:this.state.areas,users:this.state.users,center:this.state.center,removeIcons:this.removeIcons,google:this.props.google,points:this.state.points,markerClick:this.markerClick,zoom:this.state.zoom,polyClick:this.polyClick,onDragged:this.onDragged}),o.a.createElement(V,{owner:this.state.activeTabOwner,buy:this.kupitRabotyag,collect:this.collectPevko,data:this.state.points[this.state.activeTab]}),this.state.snackbar),o.a.createElement(d.e,{id:"warehouse"},o.a.createElement(d.f,{left:o.a.createElement(d.g,{onClick:function(){e.openPanel("main")}})},"\u0421\u043a\u043b\u0430\u0434 \u043f\u0435\u0432\u043a\u0430"),o.a.createElement(d.d,{mode:"secondary"},"\u041c\u043e\u0438 \u0442\u043e\u0447\u043a\u0438"),o.a.createElement(d.c,{slideWidth:"90%",style:{height:"30vh"},bullets:!1},this.state.points.length>1?this.state.userData.points.map((function(t){return o.a.createElement("div",{onClick:function(){e.setState({center:{lat:e.state.points[t].lat,lng:e.state.points[t].lon},zoom:17}),e.openPanel("main")},key:"bg"+t,style:{backgroundImage:"url("+e.state.points[t].background+")",width:"100%",height:"30vh",backgroundAttachment:"scroll",backgroundClip:"border-box",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}})})):""))))}}]),a}(o.a.Component),K=Object(_.GoogleApiWrapper)({apiKey:"AIzaSyC2L8vPYtDn5Csq-7Gj9sZqSzvb3Bx1QfI"})(W);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},27:function(e,t,a){e.exports=a.p+"static/media/pv.910d5316.png"},39:function(e,t,a){e.exports=a.p+"static/media/wh.59a4c6da.png"}},[[114,1,2]]]);
//# sourceMappingURL=main.f9dd24ff.chunk.js.map
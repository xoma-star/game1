(this.webpackJsonpgame1=this.webpackJsonpgame1||[]).push([[0],{116:function(e,t,a){e.exports=a(161)},121:function(e,t,a){},122:function(e,t,a){},161:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(29),r=a.n(i),s=(a(121),a(40)),c=a(41),l=a(17),u=a(51),p=a(50),d=(a(122),a(9)),m=(a(133),a(36)),v=a.n(m),h=v.a.initializeApp({apiKey:"AIzaSyCU3lAPlsxkBORPy2HQfCdayJNIIh0PrV4",authDomain:"game1-cae49.firebaseapp.com",databaseURL:"https://game1-cae49.firebaseio.com",projectId:"game1-cae49",storageBucket:"game1-cae49.appspot.com",messagingSenderId:"691468574984",appId:"1:691468574984:web:1c76454a2ec3020e820cbd",measurementId:"G-1B23MNQTH4"});v.a.analytics();var f=h,b=a(37),k=a.n(b),g=a(48),w=function(){var e=Object(g.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={id:t,warPoints:0,lastTaken:+new Date,points:[]},f.firestore().collection("users").doc(t.toString()).get().then((function(e){e.exists||f.firestore().collection("users").doc(t.toString()).set(a).then((function(e){console.log("\u0421\u041e\u0417\u0414\u0410\u041d \u041f\u041e\u041b\u042c\u0417\u041e\u0412\u0410\u0422\u0415\u041b\u042c"),window.location.reload()}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=a(16),E=a.n(y),C=a(23),S=a.n(C),_=function(e){var t=null,a=[];return location.search.substr(1).split("&").forEach((function(n){(a=n.split("="))[0]===e&&(t=decodeURIComponent(a[1]))})),t},P=a(27),T=a(26),I=a.n(T),O=a(34),x=a.n(O),z=a(35),D=a.n(z),j=a(38),U=a.n(j),A=a(39),M=a.n(A),V=function(){return parseInt(+new Date/1e3)},B=function(e,t){return(parseInt(V()/60)-parseInt(t/60))*e},R=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return 6*e*60},K=function(e){var t=e.data.name,a=e.data.description,n=e.owner,i=parseInt(_("vk_user_id"))===n.id,r=B(e.data.value,e.data.taken);return o.a.createElement("div",{id:"layout"},o.a.createElement("div",{id:"layoutBG",style:{backgroundImage:"url("+e.data.background+")",width:"100%",height:"30vh",backgroundAttachment:"scroll",backgroundClip:"border-box",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}}),o.a.createElement(d.c,{className:"layoutName"},t),o.a.createElement(d.h,{before:o.a.createElement(D.a,null)},a),o.a.createElement(d.h,{before:o.a.createElement(d.b,{size:48,src:n.photo_200}),description:"\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446"},n.first_name+" "+n.last_name),o.a.createElement(d.h,{style:i?{display:"none"}:{},onClick:e.buy,multiline:!0,before:o.a.createElement("img",{src:I.a,alt:"\u043f\u0435\u0432\u043a\u043e",width:24,height:24}),expandable:!0},"\u041f\u0435\u0440\u0435\u043c\u0430\u043d\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u044f\u0433 \u0437\u0430 ",B(e.data.value,e.data.taken)," \u043f\u0435\u0432\u043a\u0430"),o.a.createElement(d.h,{style:i?{}:{display:"none"},onClick:e.collect,multiline:!0,before:o.a.createElement("img",{src:I.a,alt:"\u043f\u0435\u0432\u043a\u043e",width:24,height:24}),expandable:!0,description:o.a.createElement(d.f,{value:r/R(e.data.value)*100>100?100:r/R(e.data.value)*100})},"\u0421\u043e\u0431\u0440\u0430\u0442\u044c ",r>R(e.data.value)?R(e.data.value):r," \u043f\u0435\u0432\u043a\u0430"),o.a.createElement("div",{onClick:function(){S()("#layout").removeClass("active")},style:{position:"absolute",bottom:15,left:"calc(50% - 36px)",boxShadow:"2px 2px 10px -1px rgba(0,0,0,0.55)",padding:10,borderRadius:25}},"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"))},W=a(49),G=a.n(W),L=function(e){return o.a.createElement(P.Map,{onReady:function(t,a){return e.removeIcons(t,a)},style:{width:"100%",height:"calc(100vh - 57px)"},google:e.google,zoom:14,className:"map",streetViewControl:!1,mapTypeControl:!1,scaleControl:!1,fullscreenControl:!1,zoomControl:!1,initialCenter:{lat:54.77927,lng:56.123964}},o.a.createElement(P.Marker,{num:1488,title:"\u0421\u043a\u043b\u0430\u0434 \u043f\u0435\u0432\u043a\u0430",name:"\u0421\u043a\u043b\u0430\u0434 \u043f\u0435\u0432\u043a\u0430",background:"",description:"",taken:"0",onClick:e.markerClick,position:{lat:54.777251,lng:56.127483},icon:{url:x.a,anchor:new google.maps.Point(32,32),scaledSize:new google.maps.Size(32,32)}}),o.a.createElement(P.Marker,{num:1337,title:"\u0420\u0410\u0411\u043e\u0442\u0430",name:"\u0423\u041c\u041f\u041e",background:"",description:"",taken:"0",onClick:e.markerClick,position:{lat:54.788578,lng:56.131215},icon:{url:G.a,anchor:new google.maps.Point(64,32),scaledSize:new google.maps.Size(64,32)}}),e.points.map((function(t){return o.a.createElement(P.Marker,{key:t.name+t.lat,num:t.id,title:t.name,name:t.name,background:t.background,description:t.description,taken:t.taken,onClick:e.markerClick,position:{lat:t.lat,lng:t.lon},icon:{url:I.a}})})))},N=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={activeView:"main",activePanel:"main",VK_UID:0,userData:{id:0,warPoints:0},popout:"",modal:"",snackbar:"",activeTab:0,workingProgress:0,activeTabOwner:{first_name:"\u041c\u0443\u0436\u0438\u043a",last_name:"\u0422\u0430\u0434\u0436\u0438\u043a",photo_200:"https://sun9-60.userapi.com/c849532/v849532674/13d845/_Rsu5onfz-c.jpg",points:[]},points:[{name:"\u041f\u044f\u0442\u0430\u0447\u043e\u043a",value:5,lat:54.791769,lon:56.086817,owner:0,background:"https://firebasestorage.googleapis.com/v0/b/game1-cae49.appspot.com/o/inorsBG%2F%D0%BF%D1%8F%D1%82%D0%B0%D0%BA.png?alt=media&token=e27c9707-bdb0-4dcf-96ec-586d00fea6eb",description:"\u0430\u0443\u0435",taken:0}]},n.openPanel=n.openPanel.bind(Object(l.a)(n)),n.markerClick=n.markerClick.bind(Object(l.a)(n)),n.openCaptureModal=n.openCaptureModal.bind(Object(l.a)(n)),n.kupitRabotyag=n.kupitRabotyag.bind(Object(l.a)(n)),n.collectPevko=n.collectPevko.bind(Object(l.a)(n)),n.pointOwnerUpdate=n.pointOwnerUpdate.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.setState({VK_UID:_("vk_user_id")}),E.a.send("VKWebAppInit",{}).then((function(){return console.log("\u0412\u041a \u041f\u041e\u0414\u041a\u041b\u042e\u0427\u0415\u041d")})),w(_("vk_user_id")).then((function(){f.firestore().collection("users").doc(_("vk_user_id").toString()).onSnapshot((function(t){e.setState({userData:t.data()})})),f.firestore().collection("data").doc("points").onSnapshot((function(t){t.data()&&(e.setState({points:t.data().main}),e.pointOwnerUpdate())}))}))}},{key:"componentWillUnmount",value:function(){}},{key:"kupitRabotyag",value:function(){var e=this,t=o.a.createElement(d.i,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--accent)"}},o.a.createElement(U.a,{fill:"#fff",width:14,height:14}))},"\u0420\u0430\u0431\u043e\u0442\u044f\u0433\u0438 \u0442\u0435\u043f\u0435\u0440\u044c \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u043f\u0435\u0432\u043a\u043e \u0432\u0430\u043c"),a=o.a.createElement(d.i,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--field_error_border)"}},o.a.createElement(M.a,{fill:"#fff",width:14,height:14}))},"\u041d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u0435\u0432\u043a\u0430 \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u043c\u0430\u043d\u0438\u0432\u0430\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044f\u0433");this.setState({popout:o.a.createElement(d.a,{actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"},{title:"\u041f\u0435\u0440\u0435\u043a\u0443\u043f\u0438\u0442\u044c",autoclose:!0,action:function(){var n=e.state.userData.warPoints-B(e.state.points[e.state.activeTab].value,e.state.points[e.state.activeTab].taken),o=f.firestore().collection("users"),i=o.doc(e.state.points[e.state.activeTab].owner.toString());if(n>=0){e.setState({snackbar:t});var r,s=e.state.userData.points;i.get().then((function(t){r=t.data().points,s.push(e.state.activeTab),r.splice(r.indexOf(e.state.activeTab),1),i.update({points:r}).then((function(){return o.doc(_("vk_user_id").toString()).update({points:s,warPoints:n}).then((function(){var t=e.state.points;t[e.state.activeTab].owner=parseInt(_("vk_user_id")),t[e.state.activeTab].taken=V(),f.firestore().collection("data").doc("points").update({main:t}).then((function(){e.pointOwnerUpdate()}))}))}))}))}else e.setState({snackbar:a})}}],onClose:function(){e.setState({popout:null})}},o.a.createElement("h2",null,"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"),o.a.createElement("p",null,"\u041f\u0435\u0440\u0435\u043a\u0443\u043f\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u044f\u0433 \u0437\u0430 ",B(this.state.points[this.state.activeTab].value,this.state.points[this.state.activeTab].taken)," \u043f\u0438\u0432\u0430."))})}},{key:"openPanel",value:function(e){this.setState({activePanel:e})}},{key:"openView",value:function(e){this.setState({activeView:e})}},{key:"pointOwnerUpdate",value:function(){var e=this;E.a.send("VKWebAppGetAuthToken",{app_id:7446907,scope:""}).then((function(t){return E.a.send("VKWebAppCallAPIMethod",{method:"users.get",request_id:"32test",params:{fields:"photo_200",user_ids:e.state.points[e.state.activeTab].owner.toString(),v:"5.110",access_token:t.access_token}}).then((function(t){e.setState({activeTabOwner:t.response[0]})}))}))}},{key:"markerClick",value:function(e,t,a){var n=this;if("\u0421\u043a\u043b\u0430\u0434 \u043f\u0435\u0432\u043a\u0430"===e.name)return alert("\u0421\u043e\u0431\u0440\u0430\u043d\u043e \u043f\u0435\u0432\u043a\u0430"),0;if("\u0423\u041c\u041f\u041e"===e.name){var i=setInterval((function(){var e=o.a.createElement(d.i,{layout:"vertical",onClose:function(){return n.setState({snackbar:null})},before:o.a.createElement("img",{alt:"pevko",src:I.a,width:24,height:24})},"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e 15 \u043f\u0435\u0432\u043a\u0430");n.setState({workingProgress:n.state.workingProgress+10,snackbar:e}),f.firestore().collection("users").doc(_("vk_user_id").toString()).update({warPoints:n.state.userData.warPoints+15})}),1e4);return S()(".map").hide(),S()("html").addClass("wLout"),this.setState({popout:o.a.createElement(d.a,{actionsLayout:"vertical",actions:[{title:"\u041e\u0442\u043c\u0435\u043d\u0430",autoclose:!0,mode:"cancel"}],onClose:function(){S()(".map").show(),S()("html").removeClass("wLout"),n.setState({popout:null,workingProgress:0}),clearInterval(i)}},o.a.createElement("h2",null,"\u0420\u0410\u0411\u043e\u0442\u0430\u0435\u043c"),o.a.createElement(d.j,{size:"large"}))}),0}S()("#layout").addClass("active"),this.setState({activeTab:e.num}),this.pointOwnerUpdate()}},{key:"removeIcons",value:function(e,t){t.setOptions({styles:[{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]}]})}},{key:"collectPevko",value:function(){var e=this,t=B(this.state.points[this.state.activeTab].value,this.state.points[this.state.activeTab].taken);t>6*this.state.points[this.state.activeTab].value*60&&(t=6*this.state.points[this.state.activeTab].value*60);var a=o.a.createElement(d.i,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--accent)"}},o.a.createElement(U.a,{fill:"#fff",width:14,height:14}))},"\u041f\u0435\u0432\u043a\u043e (",t,") \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u043d\u0430 \u0441\u043a\u043b\u0430\u0434"),n=o.a.createElement(d.i,{layout:"vertical",onClose:function(){return e.setState({snackbar:null})},before:o.a.createElement(d.b,{size:24,style:{backgroundColor:"var(--field_error_border)"}},o.a.createElement(M.a,{fill:"#fff",width:14,height:14}))},"\u0420\u0430\u0431\u043e\u0442\u044f\u0433\u0438 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043d\u0430\u043f\u0440\u044f\u0433\u0430\u0442\u044c\u0441\u044f \u0437\u0430 \u0441\u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0432\u043a\u0430");t>=15?f.firestore().collection("users").doc(_("vk_user_id").toString()).update({warPoints:this.state.userData.warPoints+t}).then((function(){var t=e.state.points;t[e.state.activeTab].taken=V(),f.firestore().collection("data").doc("points").update({main:t}).then((function(){return e.setState({snackbar:a})}))})):this.setState({snackbar:n})}},{key:"openCaptureModal",value:function(e){}},{key:"render",value:function(){return o.a.createElement(d.g,{activeView:this.state.activeView},o.a.createElement(d.k,{popout:this.state.popout,id:"main",activePanel:this.state.activePanel},o.a.createElement(d.d,{id:"main"},o.a.createElement(d.e,null,"\u0411\u0418\u0422\u0412\u0410 \u0417\u0410 \u0418\u041d\u041e\u0420\u0421"),o.a.createElement(L,{removeIcons:this.removeIcons,google:this.props.google,points:this.state.points,markerClick:this.markerClick}),o.a.createElement(K,{owner:this.state.activeTabOwner,buy:this.kupitRabotyag,collect:this.collectPevko,data:this.state.points[this.state.activeTab]}),this.state.snackbar)))}}]),a}(o.a.Component),q=Object(P.GoogleApiWrapper)({apiKey:"AIzaSyC2L8vPYtDn5Csq-7Gj9sZqSzvb3Bx1QfI"})(N);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},26:function(e,t,a){e.exports=a.p+"static/media/pv.910d5316.png"},34:function(e,t,a){e.exports=a.p+"static/media/wh.59a4c6da.png"},49:function(e,t,a){e.exports=a.p+"static/media/UMPO.53770ec2.png"}},[[116,1,2]]]);
//# sourceMappingURL=main.e953962c.chunk.js.map